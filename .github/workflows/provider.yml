name: Pact Verify Provider (Bi-directional)

on:
  push:
    branches: [main]

jobs:
  pact-verification:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Install dependencies
        run: npm install

      - name: Start Provider API
        run: |
          npm run start & # Start your Express server in background
          sleep 5         # Wait for it to boot

      # - name: Run Pact Provider Verification Tests (Optional in Bi-Directional)
      #   run: npm run test:provider
      #   env:
      #     PACT_BROKER_BASE_URL: ${{ secrets.PACT_BROKER_BASE_URL }}
      #     PACT_BROKER_TOKEN: ${{ secrets.PACT_BROKER_TOKEN }}

      - name: Record Provider Verification
        uses: pactflow/actions/create-version-tag@v1
        with:
          pacticipant: UserService
          version: ${{ github.sha }}
          environment: main
        env:
          PACT_BROKER_BASE_URL: ${{ secrets.PACT_BROKER_BASE_URL }}
          PACT_BROKER_TOKEN: ${{ secrets.PACT_BROKER_TOKEN }}



